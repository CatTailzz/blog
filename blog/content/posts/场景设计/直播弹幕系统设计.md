---
title: 直播弹幕系统设计
subtitle:
date: 2024-09-23T02:44:59+08:00
slug: 30f1c7d
draft: true
tags:
  - draft
categories:
  - draft
# collections:
#   - draft

password:
message:
---
- 消息及时
- 用户松散，不需要维持很多连接

## 数据表

{
	用户id
	弹幕内容
	偏移时长
	真实时间戳
	扩展字段（色彩样式）
}

## 存储

可以用redis的sortedSet，缺点是需要去重，不利于刷屏，不过这点可以对key的弹幕内容做一些前后包装处理，好处是score可以设置为时间戳，可以实现天然排序，而且可以定期轮询给新来用户看。

直播结束后如果需要存储弹幕，需要转移到mysql等持久化DB中

针对瞬间大流量，需要配合MQ来做削峰

针对大量用户的读请求，可以进一步本地缓存来做一个优化，减少redis读的压力

## 其他优化

针对个别火爆直播间，通过路由匹配和一致性哈希算法，动态分配高性能服务器应对激增流量

统计直播间指标，比如在线粉丝数，活跃度，配合调度算法提供合适的资源




